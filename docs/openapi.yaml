---
openapi: 3.1.0
tags:
- name: Secrets Manager
components:
  schemas:
    SecretRequest:
      type: object
      properties:
        secret:
          type: string
          description: "The secret value to be stored. If omitted or empty, a random\
            \ secret is generated."
          examples:
          - my-secret-value
    SecretResponse:
      type: object
      required:
      - id
      - vault_id
      - secret
      properties:
        id:
          type: string
          description: The ID of the secret.
          examples:
          - secret-id-1
        vault_id:
          type: string
          description: The Keycloak Vault ID for this secret.
          examples:
          - "${vault.secret-id-1}"
        secret:
          type: string
          description: The secret value.
          examples:
          - my-secret-value
    SecretsListResponse:
      type: object
      required:
      - secret_ids
      properties:
        secret_ids:
          type: array
          items:
            type: string
          description: List of secret IDs for the realm
          examples:
          - - secret-id-1
            - secret-id-2
paths:
  /secrets-manager:
    get:
      summary: List all secrets
      description: Returns a list of all secret IDs for the realm.
      tags:
      - Secrets Manager
      responses:
        "200":
          description: List of secrets
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SecretsListResponse"
        "500":
          description: Internal server error
  /secrets-manager/{id}:
    put:
      summary: Create or update a secret
      description: "Creates a new secret or updates an existing secret. If a secret\
        \ value is not provided in the request body, a random secret will be generated."
      tags:
      - Secrets Manager
      parameters:
      - description: "The ID of the secret to update. Must match regular expression\
          \ ^[a-zA-Z0-9_.-]+$."
        required: true
        name: id
        in: path
        schema:
          type: string
      - description: "Character classes to use for random secret generation. Ignored\
          \ if secret data is provided. Specify as comma-separated values: 'lower'\
          \ (a-z), 'upper' (A-Z), 'digit' (0-9), 'special' (@#%^-_=+.:)"
        example: "lower,upper"
        required: false
        name: charset
        in: query
        schema:
          type: string
          default: "lower,upper,digit,special"
      - description: Number of characters in the generated random secret. Ignored
          if secret data is provided.
        example: 32
        required: false
        name: length
        in: query
        schema:
          maximum: 2048
          minimum: 1
          format: int32
          type: integer
          default: 60
      requestBody:
        description: "Optional secret data. If not provided, a random secret will\
          \ be generated."
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SecretRequest"
        required: false
      responses:
        "200":
          description: Secret created or updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SecretResponse"
        "400":
          description: "Bad request, e.g., invalid ID format"
        "500":
          description: Internal server error
    get:
      summary: Get a secret
      description: Retrieves a secret by its ID.
      tags:
      - Secrets Manager
      parameters:
      - description: "The ID of the secret to retrieve. Must match regular expression\
          \ ^[a-zA-Z0-9_.-]+$ and must exist."
        required: true
        name: id
        in: path
        schema:
          type: string
      responses:
        "200":
          description: Secret found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SecretResponse"
        "404":
          description: Secret not found
        "400":
          description: "Bad request, e.g., invalid ID format"
        "500":
          description: Internal server error
    delete:
      summary: Delete a secret
      description: Deletes a secret by its ID.
      tags:
      - Secrets Manager
      parameters:
      - description: "The ID of the secret to delete. Must match the regular expression\
          \ ^[a-zA-Z0-9_.-]+$."
        required: true
        name: id
        in: path
        schema:
          type: string
      responses:
        "204":
          description: Secret deleted successfully
        "400":
          description: "Bad request, e.g., invalid ID format"
        "500":
          description: Internal server error
info:
  title: Keycloak Secrets Manager
  version: 1.0-SNAPSHOT
  description: |-
    Manage per-realm Keycloak vault secrets stored in an external vault
                backend. API base URL is
                `https://<KEYCLOAK_URL>/admin/realms/<REALM_NAME>/secrets-manager/`.
                Executing the requests require Keycloak bearer token with realm administrator
                privileges.
  contact:
    name: Keycloak Vault Provider for OpenBao and HashiCorp Vault
    url: https://github.com/Nordix/keycloak-secrets-vault-provider
